<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Price Finder</title>
    <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
    <main>
        <% if (gameData) { %>
            <% let game = JSON.parse(gameData) %>
            <% if (game.success === true && game.results && game.results.items && game.results.items.length > 0) { %>
                <section>
                    <h1>Search Results (<%= game.results.items.length %> found)</h1>
                    <p>Message: <%= game.message %></p>
                    <% game.results.items.forEach(item => { %>
                        <article>
                            <h2>Title: <%= item.title || "N/A" %></h2>
                            <h3>Availability: <%= item.text || "N/A" %></h3>
                            <p>Lowest Price: <%= item.game_info && item.game_info.lowest_price ? item.game_info.lowest_price : "N/A" %></p>
                            <p>Platforms: <%= item.game_info && item.game_info.platforms ? item.game_info.platforms.map(p => p.name).join(", ") : "N/A" %></p>
                            <p>Release Date: <%= item.game_info && item.game_info.release_date ? new Date(item.game_info.release_date * 1000).toLocaleDateString() : "N/A" %></p>
                        </article>
                    <% }) %>
                </section>
            <% } else { %>
                <section>
                    <h1>No game found or invalid search</h1>
                </section>
            <% } %>
        <% } else { %>
            <% if (content) { %>
                <% let data = JSON.parse(content) %>
                <% if (data.online === true) { %>
                    <section>
                        <h1>Welcome!</h1>
                        <h2>Enter the name of your game below to find out its princing and platform information</h2>
                        <form action="/game-id" class="formContainer" method="post">
                            <!-- <label for="gameName">Enter Game Name</label> -->
                            <input type="text" placeholder="Type exact name here" name="gameName" id="gameName">
                            <button type="submit">Search</button>
                        </form>
                    </section>
                <% } else { %>
                    <section>
                        <h1>API server is down</h1>
                    </section>
                <% } %>
            <% } else { %>
                <section>
                    <h1>Could not reach API</h1>
                </section>
            <% } %>
        <% } %>
    </main>
</body>
</html>